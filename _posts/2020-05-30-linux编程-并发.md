---
title: linux编程-并发
tags: linux
---

[toc]

# 信号

## 信号概念

> 同步:
>
> 异步:
>
> 异步事件的处理:查询法,通知法

信号是软件的`中断`.

## signal

```c
#include <signal.h>
typedef void (*sighandler_t)(int);
sighandler_t signal(int signum, sighandler_t handler);
```

> void(*signal(intosignum,void (*func)(int)))(int)

`信号会打断阻塞的系统调用`

## 信号不可靠

## 可重入函数

所有的系统调用都是可重入的,一部分库函数也可以重入,如memcpy

## 信号响应过程

## 常用函数

### kill

send signal to a process

```c
#include <sys/types.h>
#include <signal.h>
int kill(pid_t pid, int sig);
```

### raise

send a signal to the caller

```c
#include <signal.h>
int raise(int sig);
```

### alarm

set an alarm clock for delivery of a signal

```c
#include <unistd.h>
unsigned int alarm(unsigned int seconds);
```

### pause

wait for signal

```c
#include <unistd.h>
int pause(void);
```

### setitimer

```c
#include <sys/time.h>
int getitimer(int which, struct itimerval *curr_value);
int setitimer(int which, const struct itimerval *new_value,
struct itimerval *old_value);
```

尽量用setitimer不要alarm

### abort

cause abnormal process termination

```c
#include <stdlib.h>
void abort(void);
```

### system

 execute a shell command

```c
#include <stdlib.h>
int system(const char *command);
```

During  execution  of  the command, SIGCHLD will be blocked, and SIGINT
       and SIGQUIT will be ignored, in the process that calls system()  (these
       signals  will  be  handled according to their defaults inside the child
       process that executes command)

### sleep

sleep for a specified number of seconds

```c
#include <unistd.h>
unsigned int sleep(unsigned int seconds);
```

## 信号集

sigemptyset, sigfillset, sigaddset, sigdelset, sigismember - POSIX sig‐nal set operations

类型:sigset_t

```C
#include <signal.h>
int sigemptyset(sigset_t *set);
int sigfillset(sigset_t *set);
int sigaddset(sigset_t *set, int signum);
int sigdelset(sigset_t *set, int signum);
int sigismember(const sigset_t *set, int signum);
```

- sigpending

```c
#include <signal.h>
int sigpending(sigset_t *set);
```

## 信号屏蔽字/pending集的处理

- sigprocmask

sigprocmask, rt_sigprocmask - examine and change blocked signals

```c
#include <signal.h>
/* Prototype for the glibc wrapper function */
int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);
/* Prototype for the underlying system call */
int rt_sigprocmask(int how, const kernel_sigset_t *set,
kernel_sigset_t *oldset, size_t sigsetsize);
/* Prototype for the legacy system call (deprecated) */
int sigprocmask(int how, const old_kernel_sigset_t *set,
old_kernel_sigset_t *oldset);
```

联系mask和pending的位图,理解原理

## 扩展函数

### sigsuspend

```c
#include <signal.h>
int sigsuspend(const sigset_t *mask);
```

### sigaction

```c
#include <signal.h>
int sigaction(int signum, const struct sigaction *act,
struct sigaction *oldact);
```

## 实时信号



# 线程