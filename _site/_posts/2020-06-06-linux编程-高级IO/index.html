<p>[toc]</p>

<h1 id="非阻塞io">非阻塞IO</h1>

<h2 id="非阻塞io概念">非阻塞IO概念</h2>

<p>简单流程:自然流程是结构化的</p>

<p>复杂流程:自然流程不是结构化的</p>

<h2 id="io多路转接">IO多路转接</h2>

<ul>
  <li>select</li>
</ul>

<blockquote>
  <p>synchronous I/O  multiplexing</p>
</blockquote>

<pre><code class="language-c">/* According to POSIX.1-2001, POSIX.1-2008 */
#include &lt;sys/select.h&gt;
/* According to earlier standards */
#include &lt;sys/time.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
int select(int nfds, fd_set *readfds, fd_set *writefds,
fd_set *exceptfds, struct timeval *timeout);
void FD_CLR(int fd, fd_set *set);
int  FD_ISSET(int fd, fd_set *set);
void FD_SET(int fd, fd_set *set);
void FD_ZERO(fd_set *set);
#include &lt;sys/select.h&gt;
int pselect(int nfds, fd_set *readfds, fd_set *writefds,
fd_set *exceptfds, const struct timespec *timeout,
const sigset_t *sigmask);
</code></pre>

<ul>
  <li>poll</li>
</ul>

<blockquote>
  <p>wait for some event on a file descriptor</p>
</blockquote>

<pre><code class="language-c">#include &lt;poll.h&gt;
int poll(struct pollfd *fds, nfds_t nfds, int timeout);
#define _GNU_SOURCE         /* See feature_test_macros(7) */
#include &lt;signal.h&gt;
#include &lt;poll.h&gt;
int ppoll(struct pollfd *fds, nfds_t nfds,
const struct timespec *tmo_p, const sigset_t *sigmask);
</code></pre>

<ul>
  <li>epoll</li>
</ul>

<blockquote>
  <p>I/O event notification facility</p>
</blockquote>

<p>查看机制</p>

<pre><code class="language-sh">man 7 epoll
</code></pre>

<h2 id="其他读写函数">其他读写函数</h2>

<ul>
  <li>readv</li>
  <li>writev</li>
</ul>

<blockquote>
  <p>read or write data into multiple buffers</p>
</blockquote>

<pre><code class="language-c">#include &lt;sys/uio.h&gt;
ssize_t readv(int fd, const struct iovec *iov, int iovcnt);
ssize_t writev(int fd, const struct iovec *iov, int iovcnt);
ssize_t preadv(int fd, const struct iovec *iov, int iovcnt,
off_t offset);
ssize_t pwritev(int fd, const struct iovec *iov, int iovcnt,
off_t offset);
ssize_t preadv2(int fd, const struct iovec *iov, int iovcnt,
off_t offset, int flags);
ssize_t pwritev2(int fd, const struct iovec *iov, int iovcnt,
off_t offset, int flags);
struct iovec {
               void  *iov_base;    /* Starting address */
               size_t iov_len;     /* Number of bytes to transfer */
           };
</code></pre>

<h2 id="存储映射io">存储映射IO</h2>

<ul>
  <li>mmap</li>
</ul>

<blockquote>
  <p>map or unmap files or devices into memory</p>
</blockquote>

<pre><code class="language-c">#include &lt;sys/mman.h&gt;
void *mmap(void *addr, size_t length, int prot, int flags,
int fd, off_t offset);
int munmap(void *addr, size_t length);
</code></pre>

<h2 id="文件锁">文件锁</h2>

<ul>
  <li>lockf</li>
</ul>

<blockquote>
  <p>test or remove a POSIX lock on an open file</p>
</blockquote>

<pre><code class="language-c">#include &lt;unistd.h&gt;
int lockf(int fd, int cmd, off_t len);
</code></pre>

<ul>
  <li>flock</li>
</ul>

<blockquote>
  <p>apply or remove an advisory lock on an open file</p>
</blockquote>

<pre><code class="language-c">#include &lt;sys/file.h&gt;
int flock(int fd, int operation);
</code></pre>

<h1 id="有限状态机编程">有限状态机编程</h1>
