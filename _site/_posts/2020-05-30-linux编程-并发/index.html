<!DOCTYPE html>
<html>

<head>
  
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>linux编程-并发 | lazycat</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="linux编程-并发" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="[toc]" />
<meta property="og:description" content="[toc]" />
<link rel="canonical" href="http://localhost:4000/_posts/2020-05-30-linux%E7%BC%96%E7%A8%8B-%E5%B9%B6%E5%8F%91/" />
<meta property="og:url" content="http://localhost:4000/_posts/2020-05-30-linux%E7%BC%96%E7%A8%8B-%E5%B9%B6%E5%8F%91/" />
<meta property="og:site_name" content="lazycat" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-30T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"linux编程-并发","dateModified":"2020-05-30T00:00:00+08:00","datePublished":"2020-05-30T00:00:00+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/_posts/2020-05-30-linux%E7%BC%96%E7%A8%8B-%E5%B9%B6%E5%8F%91/"},"url":"http://localhost:4000/_posts/2020-05-30-linux%E7%BC%96%E7%A8%8B-%E5%B9%B6%E5%8F%91/","description":"[toc]","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  
  
  <meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1"
/>
<meta
  http-equiv="content-type"
  content="text/html; charset=utf-8"
/>
<link
  rel="alternate"
  href="/feed.xml"
  title="RSS"
  type="application/rss+xml"
/>

  
  <link
  rel="apple-touch-icon-precomposed"
  href="https://pic.cr173.com/up/2017-8/2017841818322084.jpg"
/>
<link
  rel="shortcut
  icon"
  href="https://pic.cr173.com/up/2017-8/2017841818322084.jpg"
/>

  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/combine/gh/poole/lanyon@v1.1.0/public/css/poole.min.css,gh/poole/lanyon@v1.1.0/public/css/lanyon.min.css"
/>

  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"
/>

  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/Dreamer-Paul/Pio@2.4/static/pio.min.css"
/>
<script
  async="async"
  src="https://cdn.jsdelivr.net/combine/gh/Dreamer-Paul/Pio@2.4/static/l2d.min.js,gh/Dreamer-Paul/Pio@2.4/static/pio.min.js"
  onload='
      let pio_container = document.createElement("div");
      pio_container.classList.add("pio-container");
      pio_container.classList.add("right");
      pio_container.style.bottom = "-2rem";
      pio_container.style.zIndex = "1";
      document.body.insertAdjacentElement("beforeend", pio_container);
      let pio_action = document.createElement("div");
      pio_action.classList.add("pio-action");
      pio_container.insertAdjacentElement("beforeend", pio_action);
      let pio_canvas = document.createElement("canvas");
      pio_canvas.id = "pio";
      pio_canvas.style.width = "14rem";
      pio_canvas.width = "600";
      pio_canvas.height = "800";
      pio_container.insertAdjacentElement("beforeend", pio_canvas);
      let pio = new Paul_Pio({
        "mode": "fixed",
        "hidden": true,
        "night": "for(let i=7; i<16; ++i) if(document.body.classList.contains(`theme-base-0`+i.toString(16))) { document.body.classList.remove(`theme-base-0`+i.toString(16)); document.body.classList.add(`theme-base-0`+((i-6)%9+7).toString(16)); break; }",
        "content": {
          "link": ["https://jekyll-theme-WuK.wu-kan.cn"],
          "skin": ["要换成我的朋友吗？", "让她放个假吧~"],
          "hidden": true,
          "custom": [{
            "selector": "a",
            "type": "link",
          }, {
            "selector": ".sidebar-toggle",
            "text": "打开侧边栏叭~"
          }, {
            "selector": ".effect-info",
            "text": "哇，你发现了什么！"
          }, {
            "selector": "#sidebar-search-input",
            "text": "想搜索什么呢？很多干货哦！"
          }, {
            "selector": "#toc",
            "text": "这是目录~"
          }, {
            "selector": ".page-title",
            "text": "这是标题~"
          }, {
            "selector": ".v",
            "text": "评论没有审核，要对自己的发言负责哦~"
          }]
        },
        "model": [
          "https:\/\/cdn.jsdelivr.net/gh/imuncle/live2d/model/33/model.2018.bls-winter.json",
          "https:\/\/cdn.jsdelivr.net/gh/imuncle/live2d/model/platelet-2/model.json",
          "https:\/\/cdn.jsdelivr.net/gh/imuncle/live2d/model/xiaomai/xiaomai.model.json",
          "https:\/\/cdn.jsdelivr.net/gh/imuncle/live2d/model/mashiro/seifuku.model.json",
          "https:\/\/cdn.jsdelivr.net/gh/imuncle/live2d/model/Violet/14.json",
          "https:\/\/cdn.jsdelivr.net/gh/xiaoski/live2d_models_collection/Kobayaxi/Kobayaxi.model.json",
          "https:\/\/cdn.jsdelivr.net/gh/xiaoski/live2d_models_collection/mikoto/mikoto.model.json",
          "https:\/\/cdn.jsdelivr.net/gh/xiaoski/live2d_models_collection/uiharu/uiharu.model.json"]
      });'
></script>

  
  <script
  src='https://zz.bdstatic.com/linksubmit/push.js'
  async="async"
></script>

  
  <script
  async="async"
  src="https://www.googletagmanager.com/gtag/js?id=UA-163543967-1"
  onload="
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-163543967-1');"
></script>

  
  <style>
  .wrap {
    transition-property: width,background-size,transform;
    transition-duration: .3s;
    transition-timing-function: ease-in-out;
    min-height: 100%;
    display: inline-block;
    background-size: 100% auto;
    background-position: 0% 0%;
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-image: url(https://www.hqwalls.com/wp-content/uploads/2012/12/Chrome-OS-hi-res-wallpapers-32.jpg);
  }
  @media (min-aspect-ratio: 2400/1850) {
    .wrap {
      background-image: url(https://www.hqwalls.com/wp-content/uploads/2012/12/Chrome-OS-hi-res-wallpapers-32.jpg);
    }
  }
  .sidebar-overlay #sidebar-checkbox:checked ~ .wrap {
    width: calc(100% - 14rem);
    background-size: calc(100% - 14rem) auto;
    transform: translateX(14rem);
  }
  .layout-reverse.sidebar-overlay #sidebar-checkbox:checked ~ .wrap {
    transform: translateX(0);
  }
</style>

  
  <style>
  .sidebar,
  html,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: PingFang SC, Menlo, Monaco, "Courier New", Microsoft JhengHei, monospace;
  }
</style>

  
  <style>
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-weight: bold;
  }
</style>

  
  <style>
  img {
    display: inline-block;
    margin: 0;
  }
</style>

  
  <style>
  ::-webkit-scrollbar {
    width: 3px;
    height: 3px;
  }
  ::-webkit-scrollbar-thumb {
    background-image: linear-gradient(45deg, Cyan 0%, Magenta 50%, Yellow 100%);
  }
</style>

  
  <style>
  ::selection {
    color: White;
    background: Black;
  }
</style>

  
</head>

<body
  class="theme-base-07 sidebar-overlay">
  
  
  
  <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
  <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"
     />
  <!-- Toggleable sidebar -->
  <div class="sidebar" id="sidebar">
    
    <div class="sidebar-item">
      <div class="effect effect-right_to_left">
        <img class="effect-img" src="https://pic.cr173.com/up/2017-8/2017841818322084.jpg" alt="img" />
        <div class="effect-info">
          lazycat<br/>
<a href="mailto:verylazycat@outlook.com">
  <i class="fas fa-envelope"></i>
</a>
<a href="https://github.com/verylazycat">
  <i class="fab fa-github"></i>
</a>

        </div>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      
      <a class="sidebar-nav-item" href="/">
        <i class="fas fa-home fa-fw"></i> 首页
      </a>
      
      <a class="sidebar-nav-item" href="/comments/">
        <i class="fas fa-comments fa-fw"></i> 留言
      </a>
      
      <a class="sidebar-nav-item" href="/tags/">
        <i class="fas fa-tags fa-fw"></i> 标签
      </a>
      
      <a class="sidebar-nav-item" href="/archive/">
        <i class="fas fa-archive fa-fw"></i> 归档
      </a>
      
      <a class="sidebar-nav-item" href="/merger/">
        <i class="fas fa-coffee fa-fw"></i> 打赏
      </a>
      
    </nav>
    <div class="sidebar-item">
      
      <style>
  #sidebar-search-input {
    background: none;
    border: none;
    color: White;
    width: 100%;
  }
  #sidebar-search-results-container {
    overflow: auto auto;
    max-height: 50vh;
  }
</style>
<input
  id="sidebar-search-input"
  placeholder="搜索博文"
/>
<ol
  id="sidebar-search-results-container"
></ol>
<script
  src='https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.7/dest/simple-jekyll-search.min.js'
  async='async'
  onload='
    SimpleJekyllSearch({
      json: "/assets/simple-jekyll-search/search.json",
      searchInput: document.getElementById("sidebar-search-input"),
      resultsContainer: document.getElementById("sidebar-search-results-container"),
      searchResultTemplate: `<li><a href="{url}">{title}</a></li>`,
      limit: 999,
      fuzzy: true
    })'
></script>

      
      
      <style>
  #toc {
    overflow: auto auto;
    max-height: 50vh;
  }
</style>

      <ol id="toc">
  <li><a href="#%E4%BF%A1%E5%8F%B7">信号</a>
    <ol>
      <li><a href="#%E4%BF%A1%E5%8F%B7%E6%A6%82%E5%BF%B5">信号概念</a></li>
      <li><a href="#signal">signal</a></li>
      <li><a href="#%E4%BF%A1%E5%8F%B7%E4%B8%8D%E5%8F%AF%E9%9D%A0">信号不可靠</a></li>
      <li><a href="#%E5%8F%AF%E9%87%8D%E5%85%A5%E5%87%BD%E6%95%B0">可重入函数</a></li>
      <li><a href="#%E4%BF%A1%E5%8F%B7%E5%93%8D%E5%BA%94%E8%BF%87%E7%A8%8B">信号响应过程</a></li>
      <li><a href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0">常用函数</a>
        <ol>
          <li><a href="#kill">kill</a></li>
          <li><a href="#raise">raise</a></li>
          <li><a href="#alarm">alarm</a></li>
          <li><a href="#pause">pause</a></li>
          <li><a href="#setitimer">setitimer</a></li>
          <li><a href="#abort">abort</a></li>
          <li><a href="#system">system</a></li>
          <li><a href="#sleep">sleep</a></li>
        </ol>
      </li>
      <li><a href="#%E4%BF%A1%E5%8F%B7%E9%9B%86">信号集</a></li>
      <li><a href="#%E4%BF%A1%E5%8F%B7%E5%B1%8F%E8%94%BD%E5%AD%97pending%E9%9B%86%E7%9A%84%E5%A4%84%E7%90%86">信号屏蔽字/pending集的处理</a></li>
      <li><a href="#%E6%89%A9%E5%B1%95%E5%87%BD%E6%95%B0">扩展函数</a>
        <ol>
          <li><a href="#sigsuspend">sigsuspend</a></li>
          <li><a href="#sigaction">sigaction</a></li>
        </ol>
      </li>
      <li><a href="#%E5%AE%9E%E6%97%B6%E4%BF%A1%E5%8F%B7">实时信号</a></li>
    </ol>
  </li>
  <li><a href="#%E7%BA%BF%E7%A8%8B">线程</a>
    <ol>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E6%A6%82%E5%BF%B5">线程概念</a></li>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E5%88%9B%E5%BB%BA">线程创建</a></li>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E7%BB%88%E6%AD%A2">线程终止</a></li>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8F%96%E6%B6%88%E9%80%89%E9%A1%B9">线程的取消选项</a></li>
      <li><a href="#%E6%A0%88%E6%B8%85%E7%90%86">栈清理</a></li>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5">线程同步</a></li>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E5%B1%9E%E6%80%A7">线程属性</a></li>
      <li><a href="#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E5%B1%9E%E6%80%A7">线程同步属性</a></li>
      <li><a href="#%E9%87%8D%E5%85%A5">重入</a>
        <ol>
          <li><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD%E7%9A%84io">多线程中的IO</a></li>
          <li><a href="#%E7%BA%BF%E7%A8%8B%E4%B8%8E%E4%BF%A1%E5%8F%B7">线程与信号</a></li>
          <li><a href="#%E7%BA%BF%E7%A8%8B%E4%B8%8Efork">线程与fork</a></li>
        </ol>
      </li>
      <li><a href="#openmp%E6%A0%87%E5%87%86">openmp标准</a></li>
    </ol>
  </li>
</ol>
      
      
      <style>
  .sidebar-checkbox {
    display: none;
  }
  .sidebar-toggle {
    position: fixed;
  }
</style>

      
      <style>
  .effect {
    margin: 1rem;
    perspective: 900px;
  }
  .effect-info {
    text-align: center;
    backface-visibility: hidden;
    position: absolute;
    top: 0;
    transform-style: preserve-3d;
  }
  .effect-img {
    z-index: 11;
    width: 100%;
    height: 100%;
    position: relative;
    transition: all 0.5s ease-in-out;
  }
  .effect-img:before {
    position: absolute;
    display: block;
  }
  .effect-right_to_left .effect-img {
    transform-origin: 0% 50%;
  }
  .effect-right_to_left:hover .effect-img {
    transform: rotate3d(0, 1, 0, -180deg);
  }
</style>

      
      <div>
  <i class="fas fa-cog fa-spin fa-fw"></i>
  <span id="run_time_day">
    <i class="fas fa-spinner fa-pulse"></i>
  </span>天
  <span id="run_time_hour">
    <i class="fas fa-spinner fa-pulse"></i>
  </span>时
  <span id="run_time_minute">
    <i class="fas fa-spinner fa-pulse"></i>
  </span>分
  <span id="run_time_second">
    <i class="fas fa-spinner fa-pulse"></i>
  </span>秒
  <script>
    setInterval(function (d,h,m,s,b) {
      function setzero(i) {
        return i < 10 ? "0" + i : i;
      }
      let BirthDay = new Date(b);
      let today = new Date();
      let timeold = (today.getTime() - BirthDay.getTime());
      let sectimeold = timeold / 1000;
      let secondsold = Math.floor(sectimeold);
      let msPerDay = 24 * 60 * 60 * 1000;
      let e_daysold = timeold / msPerDay;
      let daysold = Math.floor(e_daysold);
      let e_hrsold = (e_daysold - daysold) * 24;
      let hrsold = Math.floor(e_hrsold);
      let e_minsold = (e_hrsold - hrsold) * 60;
      let minsold = Math.floor((e_hrsold - hrsold) * 60);
      let seconds = Math.floor((e_minsold - minsold) * 60);
      d.textContent = daysold;
      h.textContent = setzero(hrsold);
      m.textContent = setzero(minsold);
      s.textContent = setzero(seconds);
    },
    1000,
    document.getElementById("run_time_day"),
    document.getElementById("run_time_hour"),
    document.getElementById("run_time_minute"),
    document.getElementById("run_time_second"),
    "05/02/2020 11:03:56")// 这是我第一篇博客的时间
  </script>
</div>

      
      <div>
  <div>
    <i class="fas fa-eye fa-fw"></i>
    <span id="busuanzi_value_page_pv">
      <i class="fas fa-spinner fa-pulse"></i>
    </span>次
  </div>
  <div>
    <i class="fas fa-paw fa-fw"></i>
    <span id="busuanzi_value_site_pv">
      <i class="fas fa-spinner fa-pulse"></i>
    </span>枚
  </div>
  <div>
    <i class="fas fa-user-friends fa-fw"></i>
    <span id="busuanzi_value_site_uv">
      <i class="fas fa-spinner fa-pulse"></i>
    </span>人
  </div>
  <script
    src='https://cdn.jsdelivr.net/npm/busuanzi@2.3.0'
    async='async'
  ></script>
</div>

      
      <div>
  <i class="fas fa-copyright fa-fw"></i>
  2020-2022 lazycat
</div>

      
      <div>
  <i class="fas fa-info-circle fa-fw"></i>
  <a href="http://beian.miit.gov.cn">
    蜀ICP备20011774号
  </a>
</div>

      
      
    </div>
  </div>
  <!-- Wrap is the content to shift when toggling the sidebar. We wrap the content to avoid any CSS collisions with our real content. -->
  
  <div class="wrap">
    
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
/>
<script
  src="https://cdn.jsdelivr.net/combine/npm/katex@0.11.1/dist/katex.min.js,npm/katex@0.11.1/dist/contrib/mathtex-script-type.min.js,npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  defer="defer"
  onload='renderMathInElement(document.body, { delimiters: [{ left: "$", right: "$", display: false }] })'
></script>



<style>
  pre.language-mermaid,
  code.language-mermaid {
    display: none;
  }
</style>
<script
  src="https://cdn.jsdelivr.net/npm/mermaid@8.5.1/dist/mermaid.min.js"
  defer="defer"
  onload='
    for(let x of document.getElementsByClassName("language-mermaid"))
      if(x.nodeName=="CODE")
      {
        let m = document.createElement("div");
        m.classList.add("mermaid");
        m.textContent = x.textContent;
        x.parentNode.insertAdjacentElement("beforebegin", m);
      }'
></script>



<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/combine/npm/prismjs@1.20.0/plugins/line-numbers/prism-line-numbers.min.css,npm/prismjs@1.20.0/plugins/toolbar/prism-toolbar.min.css,gh/PrismJS/prism-themes@1955cfef6953b3a59e66016e8a1e016b45d6cc79/themes/prism-nord.min.css"
/>
<script
  src="https://cdn.jsdelivr.net/combine/npm/prismjs@1.20.0/components/prism-core.min.js,npm/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js,npm/prismjs@1.20.0/plugins/line-numbers/prism-line-numbers.min.js,npm/prismjs@1.20.0/plugins/toolbar/prism-toolbar.min.js"
  defer="defer"
  onload='
    Prism.plugins.autoloader.languages_path = "https:\/\/cdn.jsdelivr.net/npm/prismjs/components/";
    for(let x of document.getElementsByTagName("pre"))
      x.classList.add("line-numbers");
    Prism.plugins.toolbar.registerButton("select-code", function (env) {
      let button = document.createElement("button");
      button.textContent = "select this " + env.language;
      button.addEventListener("click", function () {
        if (document.body.createTextRange) {
          let range = document.body.createTextRange();
          range.moveToElementText(env.element);
          range.select();
        } else if (window.getSelection) {
          let selection = window.getSelection();
          let range = document.createRange();
          range.selectNodeContents(env.element);
          selection.removeAllRanges();
            selection.addRange(range);
        }
      });
      return button;
    })'
></script>



<style>
  pre {
    max-height: 50vh;
    overflow: auto;
  }
</style>


<style>
  @media (min-width: 56em) {
    .container {
      max-width: 66.6%;
    }
  }
</style>


<style>
  .masthead,
  .container.content {
    padding-top: 1rem;
    padding-bottom: 1rem;
    box-shadow: 0 0 .75rem rgba(0, 0, 0, 0.1);
    background-color: rgba(255, 255, 255, 0.95);
    animation-duration: 2s;
    animation-name: fadeIn;
  }
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>



<div class="masthead">
  <h3 class="container masthead-title">
    
    linux编程-并发
    <a href="/" title="Home">
      <small>
        lazycat
      </small>
    </a>
    
  </h3>
</div>

<div class="container content">
  <div class="post">
  <span class="post-date">
    
    <i class="fas fa-calendar-day fa-fw"></i>
    30 May 2020
    
    
    <i class="fas fa-file-word fa-fw"></i>
    6094字
    
    
    <i class="fas fa-clock fa-fw"></i>
    21分
    
    
    <span class="leancloud-visitors" id="/_posts/2020-05-30-linux%E7%BC%96%E7%A8%8B-%E5%B9%B6%E5%8F%91/" data-xid="/_posts/2020-05-30-linux%E7%BC%96%E7%A8%8B-%E5%B9%B6%E5%8F%91/" data-flag-title="linux编程-并发">
      <i class="fas fa-book-reader fa-fw"></i>
      <span class="leancloud-visitors-count">
        <i class="fas fa-spinner fa-pulse"></i>
      </span>次
    </span>
    
    
    
    <i class="fas fa-tag fa-fw"></i>
    linux
    
    
    <br/>
<i class="fas fa-coffee fa-fw"></i>
<a href="/merger/">如果这篇博客帮助到你，可以请我喝一杯咖啡~</a>
<br/>
<i class="fab fa-creative-commons-by fa-fw"></i>
<a
  href="https://creativecommons.org/licenses/by/4.0/deed.zh"
  rel="license">
  CC BY 4.0
</a>
（除特别声明或转载文章外）

    
  </span>
  <p>[toc]</p>

<h1 id="信号">信号</h1>

<h2 id="信号概念">信号概念</h2>

<blockquote>
  <p>同步:</p>

  <p>异步:</p>

  <p>异步事件的处理:查询法,通知法</p>
</blockquote>

<p>信号是软件的<code>中断</code>.</p>

<h2 id="signal">signal</h2>

<pre><code class="language-c">#include &lt;signal.h&gt;
typedef void (*sighandler_t)(int);
sighandler_t signal(int signum, sighandler_t handler);
</code></pre>

<blockquote>
  <p>void(<em>signal(intosignum,void (</em>func)(int)))(int)</p>
</blockquote>

<p><code>信号会打断阻塞的系统调用</code></p>

<h2 id="信号不可靠">信号不可靠</h2>

<h2 id="可重入函数">可重入函数</h2>

<p>所有的系统调用都是可重入的,一部分库函数也可以重入,如memcpy</p>

<h2 id="信号响应过程">信号响应过程</h2>

<h2 id="常用函数">常用函数</h2>

<h3 id="kill">kill</h3>

<p>send signal to a process</p>

<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;signal.h&gt;
int kill(pid_t pid, int sig);
</code></pre>

<h3 id="raise">raise</h3>

<p>send a signal to the caller</p>

<pre><code class="language-c">#include &lt;signal.h&gt;
int raise(int sig);
</code></pre>

<h3 id="alarm">alarm</h3>

<p>set an alarm clock for delivery of a signal</p>

<pre><code class="language-c">#include &lt;unistd.h&gt;
unsigned int alarm(unsigned int seconds);
</code></pre>

<h3 id="pause">pause</h3>

<p>wait for signal</p>

<pre><code class="language-c">#include &lt;unistd.h&gt;
int pause(void);
</code></pre>

<h3 id="setitimer">setitimer</h3>

<pre><code class="language-c">#include &lt;sys/time.h&gt;
int getitimer(int which, struct itimerval *curr_value);
int setitimer(int which, const struct itimerval *new_value,
struct itimerval *old_value);
</code></pre>

<p>尽量用setitimer不要alarm</p>

<h3 id="abort">abort</h3>

<p>cause abnormal process termination</p>

<pre><code class="language-c">#include &lt;stdlib.h&gt;
void abort(void);
</code></pre>

<h3 id="system">system</h3>

<p>execute a shell command</p>

<pre><code class="language-c">#include &lt;stdlib.h&gt;
int system(const char *command);
</code></pre>

<p>During  execution  of  the command, SIGCHLD will be blocked, and SIGINT
       and SIGQUIT will be ignored, in the process that calls system()  (these
       signals  will  be  handled according to their defaults inside the child
       process that executes command)</p>

<h3 id="sleep">sleep</h3>

<p>sleep for a specified number of seconds</p>

<pre><code class="language-c">#include &lt;unistd.h&gt;
unsigned int sleep(unsigned int seconds);
</code></pre>

<h2 id="信号集">信号集</h2>

<p>sigemptyset, sigfillset, sigaddset, sigdelset, sigismember - POSIX sig‐nal set operations</p>

<p>类型:sigset_t</p>

<pre><code class="language-C">#include &lt;signal.h&gt;
int sigemptyset(sigset_t *set);
int sigfillset(sigset_t *set);
int sigaddset(sigset_t *set, int signum);
int sigdelset(sigset_t *set, int signum);
int sigismember(const sigset_t *set, int signum);
</code></pre>

<ul>
  <li>sigpending</li>
</ul>

<pre><code class="language-c">#include &lt;signal.h&gt;
int sigpending(sigset_t *set);
</code></pre>

<h2 id="信号屏蔽字pending集的处理">信号屏蔽字/pending集的处理</h2>

<ul>
  <li>sigprocmask</li>
</ul>

<p>sigprocmask, rt_sigprocmask - examine and change blocked signals</p>

<pre><code class="language-c">#include &lt;signal.h&gt;
/* Prototype for the glibc wrapper function */
int sigprocmask(int how, const sigset_t *set, sigset_t *oldset);
/* Prototype for the underlying system call */
int rt_sigprocmask(int how, const kernel_sigset_t *set,
kernel_sigset_t *oldset, size_t sigsetsize);
/* Prototype for the legacy system call (deprecated) */
int sigprocmask(int how, const old_kernel_sigset_t *set,
old_kernel_sigset_t *oldset);
</code></pre>

<p>联系mask和pending的位图,理解原理</p>

<h2 id="扩展函数">扩展函数</h2>

<h3 id="sigsuspend">sigsuspend</h3>

<pre><code class="language-c">#include &lt;signal.h&gt;
int sigsuspend(const sigset_t *mask);
</code></pre>

<h3 id="sigaction">sigaction</h3>

<pre><code class="language-c">#include &lt;signal.h&gt;
int sigaction(int signum, const struct sigaction *act,
struct sigaction *oldact);
</code></pre>

<h2 id="实时信号">实时信号</h2>

<h1 id="线程">线程</h1>

<h2 id="线程概念">线程概念</h2>

<p>posix标准</p>

<p>openmp线程</p>

<p>线程标识:pthread_t</p>

<p>pthread_equal</p>

<blockquote>
  <p>compare thread IDs</p>
</blockquote>

<pre><code class="language-c">#include &lt;pthread.h&gt;
int pthread_equal(pthread_t t1, pthread_t t2);
</code></pre>

<p>pthread_self</p>

<blockquote>
  <p>obtain ID of the calling thread</p>
</blockquote>

<pre><code class="language-C">#include &lt;pthread.h&gt;
pthread_t pthread_self(void);
</code></pre>

<h2 id="线程创建">线程创建</h2>

<p>pthread_create</p>

<blockquote>
  <p>create a new thread</p>
</blockquote>

<pre><code class="language-c">#include &lt;pthread.h&gt;
int pthread_create(pthread_t *thread, const pthread_attr_t *attr,
void *(*start_routine) (void *), void *arg);
</code></pre>

<p>线程的调度取决于调度器策略</p>

<h2 id="线程终止">线程终止</h2>

<ol>
  <li>线程从启动例程返回,返回值就是线程的退出码</li>
  <li>线程可以被同一进程中的其他线程取消</li>
  <li>线程调用<code>pthread_exi</code>t函数</li>
</ol>

<pre><code class="language-c">#include &lt;pthread.h&gt;
void pthread_exit(void *retval);
</code></pre>

<p>pthread_join</p>

<pre><code class="language-c">#include &lt;pthread.h&gt;
int pthread_join(pthread_t thread, void **retval);
</code></pre>

<h2 id="线程的取消选项">线程的取消选项</h2>

<ul>
  <li>pthread_cancel</li>
</ul>

<p>send a cancellation request to a thread</p>

<pre><code class="language-c">#include &lt;pthread.h&gt;
int pthread_cancel(pthread_t thread);
</code></pre>

<ol>
  <li>可取消状态</li>
  <li>取消类型(推迟取消)</li>
</ol>

<p>取消点必须是系统调用</p>

<h2 id="栈清理">栈清理</h2>

<ul>
  <li>pthread_cleanup_push</li>
  <li>pthread_cleanup_pop</li>
</ul>

<blockquote>
  <p>类似钩子函数</p>
</blockquote>

<p>pthread_cleanup_push, pthread_cleanup_pop - push and pop thread cancel-lation clean-up handlers</p>

<p>必须匹配使用</p>

<pre><code class="language-c">#include &lt;pthread.h&gt;
void pthread_cleanup_push(void (*routine)(void *),
void *arg);
void pthread_cleanup_pop(int execute);
</code></pre>

<h2 id="线程同步">线程同步</h2>

<blockquote>
  <p>ubuntu 环境需要安装:sudo apt-get install glibc-doc</p>

  <p>sudo apt-get install manpages-posix-dev</p>
</blockquote>

<p>互斥量</p>

<pre><code class="language-c">#include &lt;pthread.h&gt;
pthread_mutex_t fastmutex = PTHREAD_MUTEX_INITIALIZER;
pthread_mutex_t recmutex = PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP;
pthread_mutex_t errchkmutex = PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP;
int  pthread_mutex_init(pthread_mutex_t  *mutex,  const  pthread_mutex‐
attr_t *mutexattr);
int pthread_mutex_lock(pthread_mutex_t *mutex);
int pthread_mutex_trylock(pthread_mutex_t *mutex);
int pthread_mutex_unlock(pthread_mutex_t *mutex);
int pthread_mutex_destroy(pthread_mutex_t *mutex);
</code></pre>

<p>条件变量</p>

<p>类型:pthread_conf_t</p>

<ul>
  <li>pthread_cond_init</li>
  <li>pthread_cond_signal</li>
  <li>pthread_cond_broadcast</li>
  <li>pthread_cond_wait</li>
  <li>pthread_cond_timedwait</li>
  <li>pthread_cond_destroy</li>
</ul>

<pre><code class="language-c">#include &lt;pthread.h&gt;
pthread_cond_t cond = PTHREAD_COND_INITIALIZER;
int    pthread_cond_init(pthread_cond_t    *cond,    pthread_condattr_t
*cond_attr);
int pthread_cond_signal(pthread_cond_t *cond);
int pthread_cond_broadcast(pthread_cond_t *cond);
int pthread_cond_wait(pthread_cond_t *cond, pthread_mutex_t *mutex);
int   pthread_cond_timedwait(pthread_cond_t   *cond,    pthread_mutex_t
*mutex, const struct timespec *abstime);
int pthread_cond_destroy(pthread_cond_t *cond);
</code></pre>

<p>信号量</p>

<p>读写锁</p>

<p>读锁-&gt;共享锁;</p>

<p>写锁-&gt;互斥锁</p>

<h2 id="线程属性">线程属性</h2>

<ul>
  <li>pthread_attr_init</li>
  <li>pthread_attr_destroy</li>
</ul>

<pre><code class="language-c">#include &lt;pthread.h&gt;
int pthread_attr_init(pthread_attr_t *attr);
int pthread_attr_destroy(pthread_attr_t *attr);
</code></pre>

<blockquote>
  <p>pthread_attr_init, pthread_attr_destroy - initialize and destroy thread attributes object</p>
</blockquote>

<p>详细参考 SEE ALSO</p>

<h2 id="线程同步属性">线程同步属性</h2>

<p>互斥量属性</p>

<ul>
  <li>pthread_mutexattr_init</li>
  <li>pthread_mutexattr_destroy</li>
  <li>pthread_mutexattr_settype</li>
  <li>pthread_mutexattr_gettype</li>
</ul>

<pre><code class="language-c">#include &lt;pthread.h&gt;
int pthread_mutexattr_init(pthread_mutexattr_t *attr);
int pthread_mutexattr_destroy(pthread_mutexattr_t *attr);
int pthread_mutexattr_settype(pthread_mutexattr_t *attr, int kind);
int  pthread_mutexattr_gettype(const  pthread_mutexattr_t  *attr,   int
*kind);
</code></pre>

<ul>
  <li>clone</li>
</ul>

<blockquote>
  <p>create a child process</p>
</blockquote>

<pre><code class="language-c">#define _GNU_SOURCE
#include &lt;sched.h&gt;
int clone(int (*fn)(void *), void *child_stack,
int flags, void *arg, ...
/* pid_t *ptid, void *newtls, pid_t *ctid */ );
</code></pre>

<p>条件变量属性</p>

<pre><code class="language-c">#include &lt;pthread.h&gt;
pthread_cond_t cond = PTHREAD_COND_INITIALIZER;
int    pthread_cond_init(pthread_cond_t    *cond,    pthread_condattr_t
*cond_attr);
int pthread_cond_signal(pthread_cond_t *cond);
int pthread_cond_broadcast(pthread_cond_t *cond);
int pthread_cond_wait(pthread_cond_t *cond, pthread_mutex_t *mutex);
int   pthread_cond_timedwait(pthread_cond_t   *cond,    pthread_mutex_t
*mutex, const struct timespec *abstime);
int pthread_cond_destroy(pthread_cond_t *cond);
</code></pre>

<blockquote>
  <p>更多参考SEE ALSO</p>
</blockquote>

<h2 id="重入">重入</h2>

<blockquote>
  <p>POSIX标准规定发布的库要支持并发,如果不支持,函数名称要体现出来</p>
</blockquote>

<h3 id="多线程中的io">多线程中的IO</h3>

<h3 id="线程与信号">线程与信号</h3>

<ul>
  <li>pthread_sigmask</li>
  <li>sigwait</li>
  <li>pthread_kill</li>
</ul>

<pre><code class="language-c">#include &lt;signal.h&gt;
int pthread_sigmask(int how, const sigset_t *set, sigset_t *oldset);
</code></pre>

<pre><code class="language-c">#include &lt;signal.h&gt;
int sigwait(const sigset_t *set, int *sig);
</code></pre>

<pre><code class="language-c">#include &lt;signal.h&gt;
int pthread_kill(pthread_t thread, int sig);
</code></pre>

<h3 id="线程与fork">线程与fork</h3>

<hr />

<h2 id="openmp标准">openmp标准</h2>

<p>www.OpenMP.org</p>

<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
int main(int argc, char const *argv[])
{
#pragma omp parallel
{
        puts("hello");
        puts("world");
}
         exit(0);
}
</code></pre>


</div>
<div class="v">
  <i class="fas fa-spinner fa-pulse"></i>
</div>
<script
  src='https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js'
  defer='defer'
  onload='
    new Valine({
      "el": document.getElementsByClassName("v")[0],
      "appId": "9hABRddSuEkTgqLrt1VSK5B1-gzGzoHsz",
      "appKey": "NJ7RwmgrxsF7KDzlqU7YewlL",
      "placeholder": "在这里评论吧！填写邮箱可以获得 Gravatar 头像和回复通知哦",
      "requiredFields": ["nick","mail"],
      "visitor": true,
      "recordIP": true
    })'
></script>

</div>
  </div>
  
  <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  
</body>

</html>